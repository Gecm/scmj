{"version":3,"sources":["MJGame.js"],"names":["cc","Class","extends","Component","properties","gameRoot","default","type","Node","prepareRoot","_myMJArr","_options","_selectedMJ","_chupaiSprite","_mjcount","_gamecount","_hupaiTips","_hupaiLists","_playEfxs","_opts","onLoad","sys","isNative","isMobile","cvs","node","getComponent","Canvas","fitHeight","fitWidth","vv","director","loadScene","addComponent","gameNetMgr","conf","initView","initEventHandlers","active","initWanfaLabel","onGameBeign","audioMgr","playBGM","gameChild","getChildByName","Label","string","numOfMJ","numOfGames","maxNumOfGames","myselfChild","myholds","i","children","length","sprite","Sprite","push","spriteFrame","realwidth","getVisibleSize","width","scaleX","scaleY","sides","side","sideChild","Animation","opt","data","opts","hideOptions","hideChupai","dataEventHandler","self","on","initMahjongs","checkQueYiMen","detail","last","seatIndex","initMopai","replayMgr","isReplay","turn","pai","localIndex","getLocalIndex","index","setSpriteFrameByMJID","mjId","showAction","seatindex","hupai","seatData","seats","hued","initHupai","iszimo","holds","pop","initOtherMahjongs","mahjongmgr","getSpriteFrameByMJID","playEfx","playSFX","console","log","showChupai","audioUrl","getAudioURLByMJID","gangtype","chupai","addOption","btnName","childrenCount","child","name","btn","hu","gang","peng","gangpai","gp","wanfa","find","getWanfa","hupailist","hupainode","pre","getFoldPre","play","j","huinfo","info","ishupai","nc","holdsEmpty","gamestate","curaction","onMJClicked","event","isHuanSanZhang","emit","target","shoot","y","net","send","getMJIndex","getSide","lastIndex","getHoldsEmptySpriteFrame","initEmptySprites","getEmptySpriteFrame","game","sideRoot","sideHolds","num","pengs","angangs","diangangs","wangangs","idx","sortHolds","lasetIdx","mopai","l","dingque","sortMJ","lackingNum","mjid","getSelfData","hasQue","getMahjongType","Button","interactable","ret","onOptionClicked","update","dt","onDestroy","clear"],"mappings":"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","file":"MJGame.js","sourceRoot":"..\\..\\..\\..\\..\\assets\\scripts\\components","sourcesContent":["cc.Class({\r\n    extends: cc.Component,\r\n\r\n    properties: {        \r\n        gameRoot:{\r\n            default:null,\r\n            type:cc.Node\r\n        },\r\n        \r\n        prepareRoot:{\r\n            default:null,\r\n            type:cc.Node   \r\n        },\r\n        \r\n        _myMJArr:[],\r\n        _options:null,\r\n        _selectedMJ:null,\r\n        _chupaiSprite:[],\r\n        _mjcount:null,\r\n        _gamecount:null,\r\n        _hupaiTips:[],\r\n        _hupaiLists:[],\r\n        _playEfxs:[],\r\n        _opts:[],\r\n    },\r\n    \r\n    onLoad: function () {\r\n        if(!cc.sys.isNative && cc.sys.isMobile){\r\n            var cvs = this.node.getComponent(cc.Canvas);\r\n            cvs.fitHeight = true;\r\n            cvs.fitWidth = true;\r\n        }\r\n        if(!cc.vv){\r\n            cc.director.loadScene(\"loading\");\r\n            return;\r\n        }\r\n        this.addComponent(\"NoticeTip\");\r\n        this.addComponent(\"GameOver\");\r\n        //从这里判断\r\n         if(cc.vv.gameNetMgr.conf.type != \"rzmj\" ){\r\n              this.addComponent(\"DingQue\");\r\n        }\r\n       \r\n        //this.addComponent(\"DingQue\");\r\n        this.addComponent(\"PengGangs\");\r\n        this.addComponent(\"MJRoom\");\r\n        this.addComponent(\"TimePointer\");\r\n        this.addComponent(\"GameResult\");\r\n        this.addComponent(\"Chat\");\r\n        this.addComponent(\"Folds\");\r\n        this.addComponent(\"ReplayCtrl\");\r\n        this.addComponent(\"PopupMgr\");\r\n        this.addComponent(\"HuanSanZhang\");\r\n        this.addComponent(\"ReConnect\");\r\n        this.addComponent(\"Voice\");\r\n        this.addComponent(\"UserInfoShow\");\r\n        \r\n        this.initView();\r\n        this.initEventHandlers();\r\n        \r\n        this.gameRoot.active = false;\r\n        this.prepareRoot.active = true;\r\n        this.initWanfaLabel();\r\n        this.onGameBeign();\r\n        cc.vv.audioMgr.playBGM(\"bgFight.mp3\");\r\n    },\r\n    \r\n    initView:function(){\r\n        \r\n        //搜索需要的子节点\r\n        var gameChild = this.node.getChildByName(\"game\");\r\n        \r\n        this._mjcount = gameChild.getChildByName('mjcount').getComponent(cc.Label);\r\n        this._mjcount.string = \"剩余\" + cc.vv.gameNetMgr.numOfMJ + \"张\";\r\n        this._gamecount = gameChild.getChildByName('gamecount').getComponent(cc.Label);\r\n        this._gamecount.string = \"\" + cc.vv.gameNetMgr.numOfGames + \"/\" + cc.vv.gameNetMgr.maxNumOfGames + \"局\";\r\n\r\n        var myselfChild = gameChild.getChildByName(\"myself\");\r\n        var myholds = myselfChild.getChildByName(\"holds\");\r\n        \r\n        for(var i = 0; i < myholds.children.length; ++i){\r\n            var sprite = myholds.children[i].getComponent(cc.Sprite);\r\n            this._myMJArr.push(sprite);\r\n            sprite.spriteFrame = null;\r\n        }\r\n        \r\n        var realwidth = cc.director.getVisibleSize().width;\r\n        myholds.scaleX *= realwidth/1280;\r\n        myholds.scaleY *= realwidth/1280;  \r\n        \r\n        var sides = [\"myself\",\"right\",\"up\",\"left\"];\r\n        for(var i = 0; i < sides.length; ++i){\r\n            var side = sides[i];\r\n            \r\n            var sideChild = gameChild.getChildByName(side);\r\n            this._hupaiTips.push(sideChild.getChildByName(\"HuPai\"));\r\n            this._hupaiLists.push(sideChild.getChildByName(\"hupailist\"));\r\n            this._playEfxs.push(sideChild.getChildByName(\"play_efx\").getComponent(cc.Animation));\r\n            this._chupaiSprite.push(sideChild.getChildByName(\"ChuPai\").children[0].getComponent(cc.Sprite));\r\n            \r\n            var opt = sideChild.getChildByName(\"opt\");\r\n            opt.active = false;\r\n            var sprite = opt.getChildByName(\"pai\").getComponent(cc.Sprite);\r\n            var data = {\r\n                node:opt,\r\n                sprite:sprite\r\n            };\r\n            this._opts.push(data);\r\n        }\r\n        \r\n        var opts = gameChild.getChildByName(\"ops\");\r\n        this._options = opts;\r\n        this.hideOptions();\r\n        this.hideChupai();\r\n    },\r\n    \r\n    hideChupai:function(){\r\n        for(var i = 0; i < this._chupaiSprite.length; ++i){\r\n            this._chupaiSprite[i].node.active = false;\r\n        }        \r\n    },\r\n    \r\n    initEventHandlers:function(){\r\n        cc.vv.gameNetMgr.dataEventHandler = this.node;\r\n        \r\n        //初始化事件监听器\r\n        var self = this;\r\n        \r\n        this.node.on('game_holds',function(data){\r\n           self.initMahjongs();\r\n           self.checkQueYiMen();\r\n        });\r\n        \r\n        this.node.on('game_begin',function(data){\r\n            self.onGameBeign();\r\n        });\r\n        \r\n        this.node.on('game_sync',function(data){\r\n            self.onGameBeign();\r\n        });\r\n        \r\n        this.node.on('game_chupai',function(data){\r\n            data = data.detail;\r\n            self.hideChupai();\r\n            self.checkQueYiMen();\r\n            if(data.last != cc.vv.gameNetMgr.seatIndex){\r\n                self.initMopai(data.last,null);   \r\n            }\r\n            if(!cc.vv.replayMgr.isReplay() && data.turn != cc.vv.gameNetMgr.seatIndex){\r\n                self.initMopai(data.turn,-1);\r\n            }\r\n        });\r\n        \r\n        this.node.on('game_mopai',function(data){\r\n            self.hideChupai();\r\n            data = data.detail;\r\n            var pai = data.pai;\r\n            var localIndex = cc.vv.gameNetMgr.getLocalIndex(data.seatIndex);\r\n            if(localIndex == 0){\r\n                var index = 13;\r\n                var sprite = self._myMJArr[index];\r\n                self.setSpriteFrameByMJID(\"M_\",sprite,pai,index);\r\n                sprite.node.mjId = pai;                \r\n            }\r\n            else if(cc.vv.replayMgr.isReplay()){\r\n                self.initMopai(data.seatIndex,pai);\r\n            }\r\n        });\r\n        \r\n        this.node.on('game_action',function(data){\r\n            self.showAction(data.detail);\r\n        });\r\n        \r\n        this.node.on('hupai',function(data){\r\n            var data = data.detail;\r\n            //如果不是玩家自己，则将玩家的牌都放倒\r\n            var seatIndex = data.seatindex;\r\n            var localIndex = cc.vv.gameNetMgr.getLocalIndex(seatIndex);\r\n            var hupai = self._hupaiTips[localIndex];\r\n            hupai.active = true;\r\n            \r\n            if(localIndex == 0){\r\n                self.hideOptions();\r\n            }\r\n            var seatData = cc.vv.gameNetMgr.seats[seatIndex];\r\n            seatData.hued = true;\r\n            if(cc.vv.gameNetMgr.conf.type == \"xlch\"){\r\n                hupai.getChildByName(\"sprHu\").active = true;\r\n                hupai.getChildByName(\"sprZimo\").active = false;\r\n                self.initHupai(localIndex,data.hupai);\r\n                if(data.iszimo){\r\n                    if(seatData.seatindex == cc.vv.gameNetMgr.seatIndex){\r\n                        seatData.holds.pop();\r\n                        self.initMahjongs();                \r\n                    }\r\n                    else{\r\n                        self.initOtherMahjongs(seatData);\r\n                    }\r\n                } \r\n            }\r\n            else{\r\n                hupai.getChildByName(\"sprHu\").active = !data.iszimo;\r\n                hupai.getChildByName(\"sprZimo\").active = data.iszimo;\r\n                \r\n                if(!(data.iszimo && localIndex==0))\r\n                {\r\n                    //if(cc.vv.replayMgr.isReplay() == false && localIndex != 0){\r\n                    //    self.initEmptySprites(seatIndex);                \r\n                    //}\r\n                    self.initMopai(seatIndex,data.hupai);\r\n                }                                         \r\n            }\r\n            \r\n            if(cc.vv.replayMgr.isReplay() == true && cc.vv.gameNetMgr.conf.type != \"xlch\"){\r\n                var opt = self._opts[localIndex];\r\n                opt.node.active = true;\r\n                opt.sprite.spriteFrame = cc.vv.mahjongmgr.getSpriteFrameByMJID(\"M_\",data.hupai);                \r\n            }\r\n            \r\n            if(data.iszimo){\r\n                self.playEfx(localIndex,\"play_zimo\");    \r\n            }\r\n            else{\r\n                self.playEfx(localIndex,\"play_hu\");\r\n            }\r\n            \r\n            cc.vv.audioMgr.playSFX(\"nv/hu.mp3\");\r\n        });\r\n        \r\n        this.node.on('mj_count',function(data){\r\n            self._mjcount.string = \"剩余\" + cc.vv.gameNetMgr.numOfMJ + \"张\";\r\n        });\r\n        \r\n        this.node.on('game_num',function(data){\r\n            self._gamecount.string = \"\" + cc.vv.gameNetMgr.numOfGames + \"/\" + cc.vv.gameNetMgr.maxNumOfGames + \"局\";\r\n        });\r\n        \r\n        this.node.on('game_over',function(data){\r\n            self.gameRoot.active = false;\r\n            self.prepareRoot.active = true;\r\n        });\r\n        \r\n        \r\n        this.node.on('game_chupai_notify',function(data){\r\n            console.log(\"出的牌的数据\"+data);\r\n            self.hideChupai();\r\n            var seatData = data.detail.seatData;\r\n            //如果是自己，则刷新手牌\r\n            if(seatData.seatindex == cc.vv.gameNetMgr.seatIndex){\r\n                self.initMahjongs();                \r\n            }\r\n            else{\r\n                self.initOtherMahjongs(seatData);\r\n            }\r\n            self.showChupai();\r\n            var audioUrl = cc.vv.mahjongmgr.getAudioURLByMJID(data.detail.pai);\r\n            cc.vv.audioMgr.playSFX(audioUrl);\r\n        });\r\n        \r\n        this.node.on('guo_notify',function(data){\r\n            self.hideChupai();\r\n            self.hideOptions();\r\n            var seatData = data.detail;\r\n            //如果是自己，则刷新手牌\r\n            if(seatData.seatindex == cc.vv.gameNetMgr.seatIndex){\r\n                self.initMahjongs();                \r\n            }\r\n            cc.vv.audioMgr.playSFX(\"give.mp3\");\r\n        });\r\n        \r\n        this.node.on('guo_result',function(data){\r\n            self.hideOptions();\r\n        });\r\n        \r\n        this.node.on('game_dingque_finish',function(data){\r\n            self.initMahjongs();\r\n        });\r\n        \r\n        this.node.on('peng_notify',function(data){    \r\n            self.hideChupai();\r\n            \r\n            var seatData = data.detail;\r\n            if(seatData.seatindex == cc.vv.gameNetMgr.seatIndex){\r\n                self.initMahjongs();                \r\n            }\r\n            else{\r\n                self.initOtherMahjongs(seatData);\r\n            }\r\n            var localIndex = self.getLocalIndex(seatData.seatindex);\r\n            self.playEfx(localIndex,\"play_peng\");\r\n            cc.vv.audioMgr.playSFX(\"nv/peng.mp3\");\r\n            self.hideOptions();\r\n        });\r\n        \r\n        this.node.on('gang_notify',function(data){\r\n            self.hideChupai();\r\n            var data = data.detail;\r\n            var seatData = data.seatData;\r\n            var gangtype = data.gangtype;\r\n            if(seatData.seatindex == cc.vv.gameNetMgr.seatIndex){\r\n                self.initMahjongs();                \r\n            }\r\n            else{\r\n                self.initOtherMahjongs(seatData);\r\n            }\r\n            \r\n            var localIndex = self.getLocalIndex(seatData.seatindex);\r\n            if(gangtype == \"wangang\"){\r\n                self.playEfx(localIndex,\"play_guafeng\");\r\n                cc.vv.audioMgr.playSFX(\"guafeng.mp3\");\r\n            }\r\n            else{\r\n                self.playEfx(localIndex,\"play_xiayu\");\r\n                cc.vv.audioMgr.playSFX(\"rain.mp3\");\r\n            }\r\n        });\r\n        \r\n        this.node.on(\"hangang_notify\",function(data){\r\n            var data = data.detail;\r\n            var localIndex = self.getLocalIndex(data);\r\n            self.playEfx(localIndex,\"play_gang\");\r\n            cc.vv.audioMgr.playSFX(\"nv/gang.mp3\");\r\n            self.hideOptions();\r\n        });\r\n    },\r\n    \r\n    showChupai:function(){\r\n        var pai = cc.vv.gameNetMgr.chupai; \r\n        if( pai >= 0 ){\r\n            //\r\n            var localIndex = this.getLocalIndex(cc.vv.gameNetMgr.turn);\r\n            var sprite = this._chupaiSprite[localIndex];\r\n            sprite.spriteFrame = cc.vv.mahjongmgr.getSpriteFrameByMJID(\"M_\",pai);\r\n            sprite.node.active = true;   \r\n        }\r\n    },\r\n    \r\n    addOption:function(btnName,pai){\r\n        for(var i = 0; i < this._options.childrenCount; ++i){\r\n            var child = this._options.children[i]; \r\n            if(child.name == \"op\" && child.active == false){\r\n                child.active = true;\r\n                var sprite = child.getChildByName(\"opTarget\").getComponent(cc.Sprite);\r\n                sprite.spriteFrame = cc.vv.mahjongmgr.getSpriteFrameByMJID(\"M_\",pai);\r\n                var btn = child.getChildByName(btnName); \r\n                btn.active = true;\r\n                btn.pai = pai;\r\n                return;\r\n            }\r\n        }\r\n    },\r\n    \r\n    hideOptions:function(data){\r\n        this._options.active = false;\r\n        for(var i = 0; i < this._options.childrenCount; ++i){\r\n            var child = this._options.children[i]; \r\n            if(child.name == \"op\"){\r\n                child.active = false;\r\n                child.getChildByName(\"btnPeng\").active = false;\r\n                child.getChildByName(\"btnGang\").active = false;\r\n                child.getChildByName(\"btnHu\").active = false;\r\n            }\r\n        }\r\n    },\r\n    \r\n    showAction:function(data){\r\n        if(this._options.active){\r\n            this.hideOptions();\r\n        }\r\n        \r\n        if(data && (data.hu || data.gang || data.peng)){\r\n            this._options.active = true;\r\n            if(data.hu){\r\n                this.addOption(\"btnHu\",data.pai);\r\n            }\r\n            if(data.peng){\r\n                this.addOption(\"btnPeng\",data.pai);\r\n            }\r\n            \r\n            if(data.gang){\r\n                for(var i = 0; i < data.gangpai.length;++i){\r\n                    var gp = data.gangpai[i];\r\n                    this.addOption(\"btnGang\",gp);\r\n                }\r\n            }   \r\n        }\r\n    },\r\n    \r\n    initWanfaLabel:function(){\r\n        var wanfa = cc.find(\"Canvas/infobar/wanfa\").getComponent(cc.Label);\r\n        wanfa.string = cc.vv.gameNetMgr.getWanfa();\r\n    },\r\n    \r\n    initHupai:function(localIndex,pai){\r\n        if(cc.vv.gameNetMgr.conf.type == \"xlch\"){\r\n            var hupailist = this._hupaiLists[localIndex];\r\n            for(var i = 0; i < hupailist.children.length; ++i){\r\n                var hupainode = hupailist.children[i]; \r\n                if(hupainode.active == false){\r\n                    var pre = cc.vv.mahjongmgr.getFoldPre(localIndex);\r\n                    hupainode.getComponent(cc.Sprite).spriteFrame = cc.vv.mahjongmgr.getSpriteFrameByMJID(pre,pai);\r\n                    hupainode.active = true;\r\n                    break;\r\n                }\r\n            }   \r\n        }\r\n    },\r\n    \r\n    playEfx:function(index,name){\r\n        this._playEfxs[index].node.active = true;\r\n        this._playEfxs[index].play(name);\r\n    },\r\n    \r\n    onGameBeign:function(){\r\n        \r\n        for(var i = 0; i < this._playEfxs.length; ++i){\r\n            this._playEfxs[i].node.active = false;\r\n        }\r\n        \r\n        for(var i = 0; i < this._hupaiLists.length; ++i){\r\n            for(var j = 0; j < this._hupaiLists[i].childrenCount; ++j){\r\n                this._hupaiLists[i].children[j].active = false;\r\n            }\r\n        }\r\n        \r\n        for(var i = 0; i < cc.vv.gameNetMgr.seats.length; ++i){\r\n            var seatData = cc.vv.gameNetMgr.seats[i];\r\n            var localIndex = cc.vv.gameNetMgr.getLocalIndex(i);        \r\n            var hupai = this._hupaiTips[localIndex];\r\n            hupai.active = seatData.hued;\r\n            if(seatData.hued){\r\n                hupai.getChildByName(\"sprHu\").active = !seatData.iszimo;\r\n                hupai.getChildByName(\"sprZimo\").active = seatData.iszimo;\r\n            }\r\n            \r\n            if(seatData.huinfo){\r\n                for(var j = 0; j < seatData.huinfo.length; ++j){\r\n                    var info = seatData.huinfo[j];\r\n                    if(info.ishupai){\r\n                        this.initHupai(localIndex,info.pai);    \r\n                    }\r\n                }\r\n            }\r\n        }\r\n        \r\n        this.hideChupai();\r\n        this.hideOptions();\r\n        var sides = [\"right\",\"up\",\"left\"];        \r\n        var gameChild = this.node.getChildByName(\"game\");\r\n        for(var i = 0; i < sides.length; ++i){\r\n            var sideChild = gameChild.getChildByName(sides[i]);\r\n            var holds = sideChild.getChildByName(\"holds\");\r\n            for(var j = 0; j < holds.childrenCount; ++j){\r\n                var nc = holds.children[j];\r\n                nc.active = true;\r\n                nc.scaleX = 1.0;\r\n                nc.scaleY = 1.0;\r\n                var sprite = nc.getComponent(cc.Sprite); \r\n                sprite.spriteFrame = cc.vv.mahjongmgr.holdsEmpty[i+1];\r\n            }            \r\n        }\r\n      \r\n        if(cc.vv.gameNetMgr.gamestate == \"\" && cc.vv.replayMgr.isReplay() == false){\r\n            return;\r\n        }\r\n\r\n        this.gameRoot.active = true;\r\n        this.prepareRoot.active = false;\r\n        this.initMahjongs();\r\n        var seats = cc.vv.gameNetMgr.seats;\r\n        for(var i in seats){\r\n            var seatData = seats[i];\r\n            var localIndex = cc.vv.gameNetMgr.getLocalIndex(i);\r\n            if(localIndex != 0){\r\n                this.initOtherMahjongs(seatData);\r\n                if(i == cc.vv.gameNetMgr.turn){\r\n                    this.initMopai(i,-1);\r\n                }\r\n                else{\r\n                    this.initMopai(i,null);    \r\n                }\r\n            }\r\n        }\r\n        this.showChupai();\r\n        if(cc.vv.gameNetMgr.curaction != null){\r\n            this.showAction(cc.vv.gameNetMgr.curaction);\r\n            cc.vv.gameNetMgr.curaction = null;\r\n        }\r\n        \r\n        this.checkQueYiMen();\r\n    },\r\n    \r\n    onMJClicked:function(event){\r\n        if(cc.vv.gameNetMgr.isHuanSanZhang){\r\n            this.node.emit(\"mj_clicked\",event.target);\r\n            return;\r\n        }\r\n        \r\n        //如果不是自己的轮子，则忽略\r\n        if(cc.vv.gameNetMgr.turn != cc.vv.gameNetMgr.seatIndex){\r\n            console.log(\"not your turn.\" + cc.vv.gameNetMgr.turn);\r\n            return;\r\n        }\r\n        \r\n        for(var i = 0; i < this._myMJArr.length; ++i){\r\n            if(event.target == this._myMJArr[i].node){\r\n                //如果是再次点击，则出牌\r\n                if(event.target == this._selectedMJ){\r\n                    console.log(\"我的牌的ID\"+this._selectedMJ.mjId);\r\n                    this.shoot(this._selectedMJ.mjId); \r\n                    this._selectedMJ.y = 0;\r\n                    this._selectedMJ = null;\r\n                    return;\r\n                }\r\n                if(this._selectedMJ != null){\r\n                    this._selectedMJ.y = 0;\r\n                }\r\n                event.target.y = 15;\r\n                this._selectedMJ = event.target;\r\n                return;\r\n            }\r\n        }\r\n    },\r\n    \r\n    //出牌\r\n    shoot:function(mjId){\r\n        if(mjId == null){\r\n             console.log(\"我向服务器传送我出的牌\"+mjId);\r\n            return;\r\n        }\r\n       \r\n        cc.vv.net.send('chupai',mjId);\r\n    },\r\n    \r\n    getMJIndex:function(side,index){\r\n        if(side == \"right\" || side == \"up\"){\r\n            return 13 - index;\r\n        }\r\n        return index;\r\n    },\r\n    \r\n    initMopai:function(seatIndex,pai){\r\n        var localIndex = cc.vv.gameNetMgr.getLocalIndex(seatIndex);\r\n        var side = cc.vv.mahjongmgr.getSide(localIndex);\r\n        var pre = cc.vv.mahjongmgr.getFoldPre(localIndex);\r\n        \r\n        var gameChild = this.node.getChildByName(\"game\");\r\n        var sideChild = gameChild.getChildByName(side);\r\n        var holds = sideChild.getChildByName(\"holds\");\r\n\r\n        var lastIndex = this.getMJIndex(side,13);\r\n        var nc = holds.children[lastIndex];\r\n\r\n        nc.scaleX = 1.0;\r\n        nc.scaleY = 1.0;\r\n                        \r\n        if(pai == null){\r\n            nc.active = false;\r\n        }\r\n        else if(pai >= 0){\r\n            nc.active = true;\r\n            if(side == \"up\"){\r\n                nc.scaleX = 0.73;\r\n                nc.scaleY = 0.73;                    \r\n            }\r\n            var sprite = nc.getComponent(cc.Sprite); \r\n            sprite.spriteFrame = cc.vv.mahjongmgr.getSpriteFrameByMJID(pre,pai);\r\n        }\r\n        else if(pai != null){\r\n            nc.active = true;\r\n            if(side == \"up\"){\r\n                nc.scaleX = 1.0;\r\n                nc.scaleY = 1.0;                    \r\n            }\r\n            var sprite = nc.getComponent(cc.Sprite); \r\n            sprite.spriteFrame = cc.vv.mahjongmgr.getHoldsEmptySpriteFrame(side);\r\n        }\r\n    },\r\n    \r\n    initEmptySprites:function(seatIndex){\r\n        var localIndex = cc.vv.gameNetMgr.getLocalIndex(seatIndex);\r\n        var side = cc.vv.mahjongmgr.getSide(localIndex);\r\n        var pre = cc.vv.mahjongmgr.getFoldPre(localIndex);\r\n        \r\n        var gameChild = this.node.getChildByName(\"game\");\r\n        var sideChild = gameChild.getChildByName(side);\r\n        var holds = sideChild.getChildByName(\"holds\");\r\n        var spriteFrame = cc.vv.mahjongmgr.getEmptySpriteFrame(side);\r\n        for(var i = 0; i < holds.childrenCount; ++i){\r\n            var nc = holds.children[i];\r\n            nc.scaleX = 1.0;\r\n            nc.scaleY = 1.0;\r\n            \r\n            var sprite = nc.getComponent(cc.Sprite); \r\n            sprite.spriteFrame = spriteFrame;\r\n        }\r\n    },\r\n    \r\n    initOtherMahjongs:function(seatData){\r\n        //console.log(\"seat:\" + seatData.seatindex);\r\n        var localIndex = this.getLocalIndex(seatData.seatindex);\r\n        if(localIndex == 0){\r\n            return;\r\n        }\r\n        var side = cc.vv.mahjongmgr.getSide(localIndex);\r\n        var game = this.node.getChildByName(\"game\");\r\n        var sideRoot = game.getChildByName(side);\r\n        var sideHolds = sideRoot.getChildByName(\"holds\");\r\n        var num = seatData.pengs.length + seatData.angangs.length + seatData.diangangs.length + seatData.wangangs.length;\r\n        num *= 3;\r\n        for(var i = 0; i < num; ++i){\r\n            var idx = this.getMJIndex(side,i);\r\n            sideHolds.children[idx].active = false;\r\n        }\r\n        \r\n        var pre = cc.vv.mahjongmgr.getFoldPre(localIndex);\r\n        var holds = this.sortHolds(seatData);\r\n        if(holds != null && holds.length > 0){\r\n            for(var i = 0; i < holds.length; ++i){\r\n                var idx = this.getMJIndex(side,i + num);\r\n                var sprite = sideHolds.children[idx].getComponent(cc.Sprite); \r\n                if(side == \"up\"){\r\n                    sprite.node.scaleX = 0.73;\r\n                    sprite.node.scaleY = 0.73;                    \r\n                }\r\n                sprite.node.active = true;\r\n                sprite.spriteFrame = cc.vv.mahjongmgr.getSpriteFrameByMJID(pre,holds[i]);\r\n            }\r\n            \r\n            if(holds.length + num == 13){\r\n                var lasetIdx = this.getMJIndex(side,13);\r\n                sideHolds.children[lasetIdx].active = false;\r\n            }\r\n        }\r\n    },\r\n    \r\n    sortHolds:function(seatData){\r\n        var holds = seatData.holds;\r\n        if(holds == null){\r\n            return null;\r\n        }\r\n        //如果手上的牌的数目是2,5,8,11,14，表示最后一张牌是刚摸到的牌\r\n        var mopai = null;\r\n        var l = holds.length \r\n        if( l == 2 || l == 5 || l == 8 || l == 11 || l == 14){\r\n            mopai = holds.pop();\r\n        }\r\n        \r\n        var dingque = seatData.dingque;\r\n        cc.vv.mahjongmgr.sortMJ(holds,dingque);\r\n        \r\n        //将摸牌添加到最后\r\n        if(mopai != null){\r\n            holds.push(mopai);\r\n        }\r\n        return holds;\r\n    },\r\n    \r\n    initMahjongs:function(){\r\n        var seats = cc.vv.gameNetMgr.seats;\r\n        var seatData = seats[cc.vv.gameNetMgr.seatIndex];\r\n        var holds = this.sortHolds(seatData);\r\n        if(holds == null){\r\n            return;\r\n        }\r\n        \r\n        //初始化手牌\r\n        var lackingNum = (seatData.pengs.length + seatData.angangs.length + seatData.diangangs.length + seatData.wangangs.length)*3;\r\n        for(var i = 0; i < holds.length; ++i){\r\n            var mjid = holds[i];\r\n            var sprite = this._myMJArr[i + lackingNum];\r\n            sprite.node.mjId = mjid;\r\n            sprite.node.y = 0;\r\n            this.setSpriteFrameByMJID(\"M_\",sprite,mjid);\r\n        }\r\n        for(var i = 0; i < lackingNum; ++i){\r\n            var sprite = this._myMJArr[i]; \r\n            sprite.node.mjId = null;\r\n            sprite.spriteFrame = null;\r\n            sprite.node.active = false;\r\n        }\r\n        for(var i = lackingNum + holds.length; i < this._myMJArr.length; ++i){\r\n            var sprite = this._myMJArr[i]; \r\n            sprite.node.mjId = null;\r\n            sprite.spriteFrame = null;\r\n            sprite.node.active = false;            \r\n        }\r\n    },\r\n    \r\n    setSpriteFrameByMJID:function(pre,sprite,mjid){\r\n        sprite.spriteFrame = cc.vv.mahjongmgr.getSpriteFrameByMJID(pre,mjid);\r\n        sprite.node.active = true;\r\n    },\r\n    \r\n    //如果玩家手上还有缺的牌没有打，则只能打缺牌\r\n    checkQueYiMen:function(){\r\n    if(cc.vv.gameNetMgr.conf.type != \"rzmj\" ){\r\n                 \r\n                    if(cc.vv.gameNetMgr.conf==null || cc.vv.gameNetMgr.conf.type != \"xlch\" || !cc.vv.gameNetMgr.getSelfData().hued){\r\n            //遍历检查看是否有未打缺的牌 如果有，则需要将不是定缺的牌设置为不可用\r\n            var dingque = cc.vv.gameNetMgr.dingque;\r\n    //        console.log(dingque)\r\n            var hasQue = false;\r\n            if(cc.vv.gameNetMgr.seatIndex == cc.vv.gameNetMgr.turn){\r\n                for(var i = 0; i < this._myMJArr.length; ++i){\r\n                    var sprite = this._myMJArr[i];\r\n    //                console.log(\"sprite.node.mjId:\" + sprite.node.mjId);\r\n                    if(sprite.node.mjId != null){\r\n                        var type = cc.vv.mahjongmgr.getMahjongType(sprite.node.mjId);\r\n                        if(type == dingque){\r\n                            hasQue = true;\r\n                            break;\r\n                        }\r\n                    }\r\n                }            \r\n            }\r\n\r\n    //        console.log(\"hasQue:\" + hasQue);\r\n            for(var i = 0; i < this._myMJArr.length; ++i){\r\n                var sprite = this._myMJArr[i];\r\n                if(sprite.node.mjId != null){\r\n                    var type = cc.vv.mahjongmgr.getMahjongType(sprite.node.mjId);\r\n                    if(hasQue && type != dingque){\r\n                        sprite.node.getComponent(cc.Button).interactable = false;\r\n                    }\r\n                    else{\r\n                        sprite.node.getComponent(cc.Button).interactable = true;\r\n                    }\r\n                }\r\n            }   \r\n        }\r\n        else{\r\n            if(cc.vv.gameNetMgr.seatIndex == cc.vv.gameNetMgr.turn){\r\n                for(var i = 0; i < 14; ++i){\r\n                    var sprite = this._myMJArr[i]; \r\n                    if(sprite.node.active == true){\r\n                        sprite.node.getComponent(cc.Button).interactable = i == 13;\r\n                    }\r\n                }\r\n            }\r\n            else{\r\n                for(var i = 0; i < 14; ++i){\r\n                    var sprite = this._myMJArr[i]; \r\n                    if(sprite.node.active == true){\r\n                        sprite.node.getComponent(cc.Button).interactable = true;\r\n                    }\r\n                }\r\n            }\r\n        }\r\n        }\r\n    \r\n    },\r\n    \r\n    getLocalIndex:function(index){\r\n        var ret = (index - cc.vv.gameNetMgr.seatIndex + 4) % 4;\r\n        //console.log(\"old:\" + index + \",base:\" + cc.vv.gameNetMgr.seatIndex + \",new:\" + ret);\r\n        return ret;\r\n    },\r\n    \r\n    onOptionClicked:function(event){\r\n        console.log(event.target.pai);\r\n        if(event.target.name == \"btnPeng\"){\r\n            cc.vv.net.send(\"peng\");\r\n        }\r\n        else if(event.target.name == \"btnGang\"){\r\n            cc.vv.net.send(\"gang\",event.target.pai);\r\n        }\r\n        else if(event.target.name == \"btnHu\"){\r\n            cc.vv.net.send(\"hu\");\r\n        }\r\n        else if(event.target.name == \"btnGuo\"){\r\n            cc.vv.net.send(\"guo\");\r\n        }\r\n    },\r\n    \r\n    // called every frame, uncomment this function to activate update callback\r\n    update: function (dt) {\r\n    },\r\n    \r\n    onDestroy:function(){\r\n        console.log(\"onDestroy\");\r\n        if(cc.vv){\r\n            cc.vv.gameNetMgr.clear();   \r\n        }\r\n    }\r\n});\r\n"]}