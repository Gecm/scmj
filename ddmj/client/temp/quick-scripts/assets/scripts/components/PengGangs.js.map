{"version":3,"sources":["PengGangs.js"],"names":["cc","Class","extends","Component","properties","onLoad","vv","gameChild","node","getChildByName","myself","pengangroot","realwidth","director","getVisibleSize","width","scale","scaleX","scaleY","self","on","data","detail","onPengGangChanged","seatData","onGameBein","seats","gameNetMgr","i","hideSide","side","childrenCount","children","active","angangs","diangangs","wangangs","pengs","localIndex","getLocalIndex","seatindex","mahjongmgr","getSide","pre","getFoldPre","console","log","index","gangs","length","mjid","initPengAndGangs","flag","pgroot","instantiate","pengPrefabLeft","pengPrefabSelf","addChild","y","setLocalZOrder","x","sprites","getComponentsInChildren","Sprite","s","sprite","name","isGang","spriteFrame","getEmptySpriteFrame","getSpriteFrameByMJID"],"mappings":"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","file":"PengGangs.js","sourceRoot":"..\\..\\..\\..\\..\\assets\\scripts\\components","sourcesContent":["cc.Class({\r\n    extends: cc.Component,\r\n\r\n    properties: {\r\n        // foo: {\r\n        //    default: null,\r\n        //    url: cc.Texture2D,  // optional, default is typeof default\r\n        //    serializable: true, // optional, default is true\r\n        //    visible: true,      // optional, default is true\r\n        //    displayName: 'Foo', // optional\r\n        //    readonly: false,    // optional, default is false\r\n        // },\r\n        // ...\r\n    },\r\n\r\n    // use this for initialization\r\n    onLoad: function () {\r\n        if(!cc.vv){\r\n            return;\r\n        }\r\n        \r\n        var gameChild = this.node.getChildByName(\"game\");\r\n        var myself = gameChild.getChildByName(\"myself\");\r\n        var pengangroot = myself.getChildByName(\"penggangs\");\r\n        var realwidth = cc.director.getVisibleSize().width;\r\n        var scale = realwidth / 1280;\r\n        pengangroot.scaleX *= scale;\r\n        pengangroot.scaleY *= scale;\r\n        \r\n        var self = this;\r\n        this.node.on('peng_notify',function(data){\r\n            //刷新所有的牌\r\n            //console.log(data.detail);\r\n            var data = data.detail;\r\n            self.onPengGangChanged(data);\r\n        });\r\n        \r\n        this.node.on('gang_notify',function(data){\r\n            //刷新所有的牌\r\n            //console.log(data.detail);\r\n            var data = data.detail;\r\n            self.onPengGangChanged(data.seatData);\r\n        });\r\n        \r\n        this.node.on('game_begin',function(data){\r\n            self.onGameBein();\r\n        });\r\n        \r\n        var seats = cc.vv.gameNetMgr.seats;\r\n        for(var i in seats){\r\n            this.onPengGangChanged(seats[i]);\r\n        }\r\n    },\r\n    \r\n    onGameBein:function(){\r\n        this.hideSide(\"myself\");\r\n        this.hideSide(\"right\");\r\n        this.hideSide(\"up\");\r\n        this.hideSide(\"left\");\r\n    },\r\n    \r\n    hideSide:function(side){\r\n        var gameChild = this.node.getChildByName(\"game\");\r\n        var myself = gameChild.getChildByName(side);\r\n        var pengangroot = myself.getChildByName(\"penggangs\");\r\n        if(pengangroot){\r\n            for(var i = 0; i < pengangroot.childrenCount; ++i){\r\n                pengangroot.children[i].active = false;\r\n            }            \r\n        }\r\n    },\r\n    \r\n    onPengGangChanged:function(seatData){\r\n        \r\n        if(seatData.angangs == null && seatData.diangangs == null && seatData.wangangs == null && seatData.pengs == null){\r\n            return;\r\n        }\r\n        var localIndex = cc.vv.gameNetMgr.getLocalIndex(seatData.seatindex);\r\n        var side = cc.vv.mahjongmgr.getSide(localIndex);\r\n        var pre = cc.vv.mahjongmgr.getFoldPre(localIndex);\r\n       \r\n        console.log(\"onPengGangChanged\" + localIndex);\r\n            \r\n        var gameChild = this.node.getChildByName(\"game\");\r\n        var myself = gameChild.getChildByName(side);\r\n        var pengangroot = myself.getChildByName(\"penggangs\");\r\n        \r\n        for(var i = 0; i < pengangroot.childrenCount; ++i){\r\n            pengangroot.children[i].active = false;\r\n        }\r\n        //初始化杠牌\r\n        var index = 0;\r\n        \r\n        var gangs = seatData.angangs\r\n        for(var i = 0; i < gangs.length; ++i){\r\n            var mjid = gangs[i];\r\n            this.initPengAndGangs(pengangroot,side,pre,index,mjid,\"angang\");\r\n            index++;    \r\n        } \r\n        var gangs = seatData.diangangs\r\n        for(var i = 0; i < gangs.length; ++i){\r\n            var mjid = gangs[i];\r\n            this.initPengAndGangs(pengangroot,side,pre,index,mjid,\"diangang\");\r\n            index++;    \r\n        }\r\n        \r\n        var gangs = seatData.wangangs\r\n        for(var i = 0; i < gangs.length; ++i){\r\n            var mjid = gangs[i];\r\n            this.initPengAndGangs(pengangroot,side,pre,index,mjid,\"wangang\");\r\n            index++;    \r\n        }\r\n        \r\n        //初始化碰牌\r\n        var pengs = seatData.pengs\r\n        if(pengs){\r\n            for(var i = 0; i < pengs.length; ++i){\r\n                var mjid = pengs[i];\r\n                this.initPengAndGangs(pengangroot,side,pre,index,mjid,\"peng\");\r\n                index++;    \r\n            }    \r\n        }        \r\n    },\r\n    \r\n    initPengAndGangs:function(pengangroot,side,pre,index,mjid,flag){\r\n        var pgroot = null;\r\n        if(pengangroot.childrenCount <= index){\r\n            if(side == \"left\" || side == \"right\"){\r\n                pgroot = cc.instantiate(cc.vv.mahjongmgr.pengPrefabLeft);\r\n            }\r\n            else{\r\n                pgroot = cc.instantiate(cc.vv.mahjongmgr.pengPrefabSelf);\r\n            }\r\n            \r\n            pengangroot.addChild(pgroot);    \r\n        }\r\n        else{\r\n            pgroot = pengangroot.children[index];\r\n            pgroot.active = true;\r\n        }\r\n        \r\n        if(side == \"left\"){\r\n            pgroot.y = -(index * 25 * 3);                    \r\n        }\r\n        else if(side == \"right\"){\r\n            pgroot.y = (index * 25 * 3);\r\n            pgroot.setLocalZOrder(-index);\r\n        }\r\n        else if(side == \"myself\"){\r\n            pgroot.x = index * 55 * 3 + index * 10;                    \r\n        }\r\n        else{\r\n            pgroot.x = -(index * 55*3);\r\n        }\r\n\r\n        var sprites = pgroot.getComponentsInChildren(cc.Sprite);\r\n        for(var s = 0; s < sprites.length; ++s){\r\n            var sprite = sprites[s];\r\n            if(sprite.node.name == \"gang\"){\r\n                var isGang = flag != \"peng\";\r\n                sprite.node.active = isGang;\r\n                sprite.node.scaleX = 1.0;\r\n                sprite.node.scaleY = 1.0;\r\n                if(flag == \"angang\"){\r\n                    sprite.spriteFrame = cc.vv.mahjongmgr.getEmptySpriteFrame(side);\r\n                    if(side == \"myself\" || side == \"up\"){\r\n                        sprite.node.scaleX = 1.4;\r\n                        sprite.node.scaleY = 1.4;                        \r\n                    }\r\n                }   \r\n                else{\r\n                    sprite.spriteFrame = cc.vv.mahjongmgr.getSpriteFrameByMJID(pre,mjid);    \r\n                }\r\n            }\r\n            else{ \r\n                sprite.spriteFrame = cc.vv.mahjongmgr.getSpriteFrameByMJID(pre,mjid);\r\n            }\r\n        }\r\n    },\r\n\r\n    // called every frame, uncomment this function to activate update callback\r\n    // update: function (dt) {\r\n\r\n    // },\r\n});\r\n"]}