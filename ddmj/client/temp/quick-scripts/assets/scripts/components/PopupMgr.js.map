{"version":3,"sources":["PopupMgr.js"],"names":["cc","Class","extends","Component","properties","_popuproot","_settings","_dissolveNotice","_endTime","_extraInfo","_noticeLabel","onLoad","vv","popupMgr","find","getChildByName","getComponent","Label","closeAll","addBtnHandler","self","node","on","event","data","detail","showDissolveNotice","start","gameNetMgr","dissoveData","btnName","btn","addClickEvent","target","component","handler","eventHandler","EventHandler","clickEvents","Button","push","onBtnClicked","name","net","send","active","showSettings","showDissolveRequest","Date","now","time","i","states","length","b","seats","update","dt","lastTime","m","Math","floor","s","ceil","str","string"],"mappings":";;;;;;AAAAA,GAAGC,KAAH,CAAS;AACLC,aAASF,GAAGG,SADP;;AAGLC,gBAAY;AACR;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACAC,oBAAW,IAVH;AAWRC,mBAAU,IAXF;AAYRC,yBAAgB,IAZR;;AAcRC,kBAAS,CAAC,CAdF;AAeRC,oBAAW,IAfH;AAgBRC,sBAAa;AAhBL,KAHP;;AAsBL;AACAC,YAAQ,kBAAY;AAChB,YAAGX,GAAGY,EAAH,IAAS,IAAZ,EAAiB;AACb;AACH;;AAEDZ,WAAGY,EAAH,CAAMC,QAAN,GAAiB,IAAjB;;AAEA,aAAKR,UAAL,GAAkBL,GAAGc,IAAH,CAAQ,eAAR,CAAlB;AACA,aAAKR,SAAL,GAAiBN,GAAGc,IAAH,CAAQ,wBAAR,CAAjB;AACA,aAAKP,eAAL,GAAuBP,GAAGc,IAAH,CAAQ,+BAAR,CAAvB;AACA,aAAKJ,YAAL,GAAoB,KAAKH,eAAL,CAAqBQ,cAArB,CAAoC,MAApC,EAA4CC,YAA5C,CAAyDhB,GAAGiB,KAA5D,CAApB;;AAEA,aAAKC,QAAL;;AAEA,aAAKC,aAAL,CAAmB,oBAAnB;AACA,aAAKA,aAAL,CAAmB,qBAAnB;AACA,aAAKA,aAAL,CAAmB,2BAAnB;AACA,aAAKA,aAAL,CAAmB,4BAAnB;AACA,aAAKA,aAAL,CAAmB,wBAAnB;;AAEA,YAAIC,OAAO,IAAX;AACA,aAAKC,IAAL,CAAUC,EAAV,CAAa,iBAAb,EAA+B,UAASC,KAAT,EAAe;AAC1C,gBAAIC,OAAOD,MAAME,MAAjB;AACAL,iBAAKM,kBAAL,CAAwBF,IAAxB;AACH,SAHD;;AAKA,aAAKH,IAAL,CAAUC,EAAV,CAAa,iBAAb,EAA+B,UAASC,KAAT,EAAe;AAC1CH,iBAAKF,QAAL;AACH,SAFD;AAGH,KApDI;;AAsDLS,WAAM,iBAAU;AACZ,YAAG3B,GAAGY,EAAH,CAAMgB,UAAN,CAAiBC,WAApB,EAAgC;AAC5B,iBAAKH,kBAAL,CAAwB1B,GAAGY,EAAH,CAAMgB,UAAN,CAAiBC,WAAzC;AACH;AACJ,KA1DI;;AA4DLV,mBAAc,uBAASW,OAAT,EAAiB;AAC3B,YAAIC,MAAM/B,GAAGc,IAAH,CAAQ,mBAAmBgB,OAA3B,CAAV;AACA,aAAKE,aAAL,CAAmBD,GAAnB,EAAuB,KAAKV,IAA5B,EAAiC,UAAjC,EAA4C,cAA5C;AACH,KA/DI;;AAiELW,mBAAc,uBAASX,IAAT,EAAcY,MAAd,EAAqBC,SAArB,EAA+BC,OAA/B,EAAuC;AACjD,YAAIC,eAAe,IAAIpC,GAAGG,SAAH,CAAakC,YAAjB,EAAnB;AACAD,qBAAaH,MAAb,GAAsBA,MAAtB;AACAG,qBAAaF,SAAb,GAAyBA,SAAzB;AACAE,qBAAaD,OAAb,GAAuBA,OAAvB;;AAEA,YAAIG,cAAcjB,KAAKL,YAAL,CAAkBhB,GAAGuC,MAArB,EAA6BD,WAA/C;AACAA,oBAAYE,IAAZ,CAAiBJ,YAAjB;AACH,KAzEI;;AA2ELK,kBAAa,sBAASlB,KAAT,EAAe;AACxB,aAAKL,QAAL;AACA,YAAIY,UAAUP,MAAMU,MAAN,CAAaS,IAA3B;AACA,YAAGZ,WAAW,WAAd,EAA0B;AACtB9B,eAAGY,EAAH,CAAM+B,GAAN,CAAUC,IAAV,CAAe,gBAAf;AACH,SAFD,MAGK,IAAGd,WAAW,YAAd,EAA2B;AAC5B9B,eAAGY,EAAH,CAAM+B,GAAN,CAAUC,IAAV,CAAe,iBAAf;AACH,SAFI,MAGA,IAAGd,WAAW,YAAd,EAA2B;AAC5B9B,eAAGY,EAAH,CAAM+B,GAAN,CAAUC,IAAV,CAAe,kBAAf;AACH;AACJ,KAvFI;;AAyFL1B,cAAS,oBAAU;AACf,aAAKb,UAAL,CAAgBwC,MAAhB,GAAyB,KAAzB;AACA,aAAKvC,SAAL,CAAeuC,MAAf,GAAwB,KAAxB;AACA,aAAKtC,eAAL,CAAqBsC,MAArB,GAA8B,KAA9B;AACH,KA7FI;;AA+FLC,kBAAa,wBAAU;AACnB,aAAK5B,QAAL;AACA,aAAKb,UAAL,CAAgBwC,MAAhB,GAAyB,IAAzB;AACA,aAAKvC,SAAL,CAAeuC,MAAf,GAAwB,IAAxB;AACH,KAnGI;;AAqGLE,yBAAoB,+BAAU;AAC1B,aAAK7B,QAAL;AACA,aAAKb,UAAL,CAAgBwC,MAAhB,GAAyB,IAAzB;AACH,KAxGI;;AA0GLnB,wBAAmB,4BAASF,IAAT,EAAc;AAC7B,aAAKhB,QAAL,GAAgBwC,KAAKC,GAAL,KAAW,IAAX,GAAkBzB,KAAK0B,IAAvC;AACA,aAAKzC,UAAL,GAAkB,EAAlB;AACA,aAAI,IAAI0C,IAAI,CAAZ,EAAeA,IAAI3B,KAAK4B,MAAL,CAAYC,MAA/B,EAAuC,EAAEF,CAAzC,EAA2C;AACvC,gBAAIG,IAAI9B,KAAK4B,MAAL,CAAYD,CAAZ,CAAR;AACA,gBAAIT,OAAO1C,GAAGY,EAAH,CAAMgB,UAAN,CAAiB2B,KAAjB,CAAuBJ,CAAvB,EAA0BT,IAArC;AACA,gBAAGY,CAAH,EAAK;AACD,qBAAK7C,UAAL,IAAmB,aAAYiC,IAA/B;AACH,aAFD,MAGI;AACA,qBAAKjC,UAAL,IAAmB,aAAYiC,IAA/B;AACH;AACJ;AACD,aAAKxB,QAAL;AACA,aAAKb,UAAL,CAAgBwC,MAAhB,GAAyB,IAAzB;AACA,aAAKtC,eAAL,CAAqBsC,MAArB,GAA8B,IAA9B,CAAmC;AACtC,KA1HI;;AA4HL;AACAW,YAAQ,gBAAUC,EAAV,EAAc;AAClB,YAAG,KAAKjD,QAAL,GAAgB,CAAnB,EAAqB;AACjB,gBAAIkD,WAAW,KAAKlD,QAAL,GAAgBwC,KAAKC,GAAL,KAAa,IAA5C;AACA,gBAAGS,WAAW,CAAd,EAAgB;AACZ,qBAAKlD,QAAL,GAAgB,CAAC,CAAjB;AACH;;AAED,gBAAImD,IAAIC,KAAKC,KAAL,CAAWH,WAAW,EAAtB,CAAR;AACA,gBAAII,IAAIF,KAAKG,IAAL,CAAUL,WAAWC,IAAE,EAAvB,CAAR;;AAEA,gBAAIK,MAAM,EAAV;AACA,gBAAGL,IAAI,CAAP,EAAS;AACLK,uBAAOL,IAAI,GAAX;AACH;;AAED,iBAAKjD,YAAL,CAAkBuD,MAAlB,GAA2BD,MAAMF,CAAN,GAAU,WAAV,GAAwB,KAAKrD,UAAxD;AACH;AACJ;AA9II,CAAT","file":"PopupMgr.js","sourceRoot":"..\\..\\..\\..\\..\\assets\\scripts\\components","sourcesContent":["cc.Class({\r\n    extends: cc.Component,\r\n\r\n    properties: {\r\n        // foo: {\r\n        //    default: null,\r\n        //    url: cc.Texture2D,  // optional, default is typeof default\r\n        //    serializable: true, // optional, default is true\r\n        //    visible: true,      // optional, default is true\r\n        //    displayName: 'Foo', // optional\r\n        //    readonly: false,    // optional, default is false\r\n        // },\r\n        // ...\r\n        _popuproot:null,\r\n        _settings:null,\r\n        _dissolveNotice:null,\r\n        \r\n        _endTime:-1,\r\n        _extraInfo:null,\r\n        _noticeLabel:null,\r\n    },\r\n\r\n    // use this for initialization\r\n    onLoad: function () {\r\n        if(cc.vv == null){\r\n            return;\r\n        }\r\n        \r\n        cc.vv.popupMgr = this;\r\n        \r\n        this._popuproot = cc.find(\"Canvas/popups\");\r\n        this._settings = cc.find(\"Canvas/popups/settings\");\r\n        this._dissolveNotice = cc.find(\"Canvas/popups/dissolve_notice\");\r\n        this._noticeLabel = this._dissolveNotice.getChildByName(\"info\").getComponent(cc.Label);\r\n        \r\n        this.closeAll();\r\n        \r\n        this.addBtnHandler(\"settings/btn_close\");\r\n        this.addBtnHandler(\"settings/btn_sqjsfj\");\r\n        this.addBtnHandler(\"dissolve_notice/btn_agree\");\r\n        this.addBtnHandler(\"dissolve_notice/btn_reject\");\r\n        this.addBtnHandler(\"dissolve_notice/btn_ok\");\r\n        \r\n        var self = this;\r\n        this.node.on(\"dissolve_notice\",function(event){\r\n            var data = event.detail;\r\n            self.showDissolveNotice(data);\r\n        });\r\n        \r\n        this.node.on(\"dissolve_cancel\",function(event){\r\n            self.closeAll();\r\n        });\r\n    },\r\n    \r\n    start:function(){\r\n        if(cc.vv.gameNetMgr.dissoveData){\r\n            this.showDissolveNotice(cc.vv.gameNetMgr.dissoveData);\r\n        }\r\n    },\r\n    \r\n    addBtnHandler:function(btnName){\r\n        var btn = cc.find(\"Canvas/popups/\" + btnName);\r\n        this.addClickEvent(btn,this.node,\"PopupMgr\",\"onBtnClicked\");\r\n    },\r\n    \r\n    addClickEvent:function(node,target,component,handler){\r\n        var eventHandler = new cc.Component.EventHandler();\r\n        eventHandler.target = target;\r\n        eventHandler.component = component;\r\n        eventHandler.handler = handler;\r\n\r\n        var clickEvents = node.getComponent(cc.Button).clickEvents;\r\n        clickEvents.push(eventHandler);\r\n    },\r\n    \r\n    onBtnClicked:function(event){\r\n        this.closeAll();\r\n        var btnName = event.target.name;\r\n        if(btnName == \"btn_agree\"){\r\n            cc.vv.net.send(\"dissolve_agree\");\r\n        }\r\n        else if(btnName == \"btn_reject\"){\r\n            cc.vv.net.send(\"dissolve_reject\");\r\n        }\r\n        else if(btnName == \"btn_sqjsfj\"){\r\n            cc.vv.net.send(\"dissolve_request\"); \r\n        }\r\n    },\r\n    \r\n    closeAll:function(){\r\n        this._popuproot.active = false;\r\n        this._settings.active = false;\r\n        this._dissolveNotice.active = false;\r\n    },\r\n    \r\n    showSettings:function(){\r\n        this.closeAll();\r\n        this._popuproot.active = true;\r\n        this._settings.active = true;\r\n    },\r\n    \r\n    showDissolveRequest:function(){\r\n        this.closeAll();\r\n        this._popuproot.active = true;\r\n    },\r\n    \r\n    showDissolveNotice:function(data){\r\n        this._endTime = Date.now()/1000 + data.time;\r\n        this._extraInfo = \"\";\r\n        for(var i = 0; i < data.states.length; ++i){\r\n            var b = data.states[i];\r\n            var name = cc.vv.gameNetMgr.seats[i].name;\r\n            if(b){\r\n                this._extraInfo += \"\\n[已同意] \"+ name;\r\n            }\r\n            else{\r\n                this._extraInfo += \"\\n[待确认] \"+ name;\r\n            }\r\n        }\r\n        this.closeAll();\r\n        this._popuproot.active = true;\r\n        this._dissolveNotice.active = true;;\r\n    },\r\n    \r\n    // called every frame, uncomment this function to activate update callback\r\n    update: function (dt) {\r\n        if(this._endTime > 0){\r\n            var lastTime = this._endTime - Date.now() / 1000;\r\n            if(lastTime < 0){\r\n                this._endTime = -1;\r\n            }\r\n            \r\n            var m = Math.floor(lastTime / 60);\r\n            var s = Math.ceil(lastTime - m*60);\r\n            \r\n            var str = \"\";\r\n            if(m > 0){\r\n                str += m + \"分\"; \r\n            }\r\n            \r\n            this._noticeLabel.string = str + s + \"秒后房间将自动解散\" + this._extraInfo;\r\n        }\r\n    },\r\n});\r\n"]}