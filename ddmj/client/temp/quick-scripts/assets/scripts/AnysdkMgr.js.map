{"version":3,"sources":["AnysdkMgr.js"],"names":["cc","Class","extends","Component","properties","_isCapturing","onLoad","init","ANDROID_API","IOS_API","login","share","title","desc","shareResult","size","director","getWinSize","currentDate","Date","fileName","fullPath","jsb","fileUtils","getWritablePath","isFileExist","removeFile","texture","RenderTexture","Math","floor","width","height","setPosition","p","begin","getRunningScene","visit","end","saveToFile","IMAGE_FORMAT_JPG","self","tryTimes","fn","scale","console","log","setTimeout","onLoginResp","code"],"mappings":";;;;;;AAAAA,GAAGC,KAAH,CAAS;AACLC,aAASF,GAAGG,SADP;;AAGLC,gBAAY;AACR;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACAC,sBAAa;AAXL,KAHP;;AAiBL;AACAC,YAAQ,kBAAY,CACnB,CAnBI;;AAqBL;AACA;;AAEA;;AAEAC,UAAK,gBAAU;AACX,aAAKC,WAAL,GAAmB,0BAAnB;AACA,aAAKC,OAAL,GAAe,eAAf;AACH,KA7BI;;AA+BLC,WAAM,iBAAU;;AAEZ;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACH,KA3CI;;AA6CLC,WAAM,eAASC,KAAT,EAAeC,IAAf,EAAoB;AACtB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACH,KAvDI;;AAyDLC,iBAAY,uBAAU;AAClB,YAAG,KAAKT,YAAR,EAAqB;AACjB;AACH;AACD,aAAKA,YAAL,GAAoB,IAApB;AACA,YAAIU,OAAOf,GAAGgB,QAAH,CAAYC,UAAZ,EAAX;AACA,YAAIC,cAAc,IAAIC,IAAJ,EAAlB;AACA,YAAIC,WAAW,kBAAf;AACA,YAAIC,WAAWC,IAAIC,SAAJ,CAAcC,eAAd,KAAkCJ,QAAjD;AACA,YAAGE,IAAIC,SAAJ,CAAcE,WAAd,CAA0BJ,QAA1B,CAAH,EAAuC;AACnCC,gBAAIC,SAAJ,CAAcG,UAAd,CAAyBL,QAAzB;AACH;AACD,YAAIM,UAAU,IAAI3B,GAAG4B,aAAP,CAAqBC,KAAKC,KAAL,CAAWf,KAAKgB,KAAhB,CAArB,EAA6CF,KAAKC,KAAL,CAAWf,KAAKiB,MAAhB,CAA7C,CAAd;AACAL,gBAAQM,WAAR,CAAoBjC,GAAGkC,CAAH,CAAKnB,KAAKgB,KAAL,GAAW,CAAhB,EAAmBhB,KAAKiB,MAAL,GAAY,CAA/B,CAApB;AACAL,gBAAQQ,KAAR;AACAnC,WAAGgB,QAAH,CAAYoB,eAAZ,GAA8BC,KAA9B;AACAV,gBAAQW,GAAR;AACAX,gBAAQY,UAAR,CAAmBnB,QAAnB,EAA6BpB,GAAGwC,gBAAhC;;AAEA,YAAIC,OAAO,IAAX;AACA,YAAIC,WAAW,CAAf;AACA,YAAIC,KAAK,SAALA,EAAK,GAAU;AACf,gBAAGrB,IAAIC,SAAJ,CAAcE,WAAd,CAA0BJ,QAA1B,CAAH,EAAuC;AACnC,oBAAIW,SAAS,GAAb;AACA,oBAAIY,QAAQZ,SAAOjB,KAAKiB,MAAxB;AACT,oBAAID,QAAQF,KAAKC,KAAL,CAAWf,KAAKgB,KAAL,GAAaa,KAAxB,CAAZ;;AAES;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACAH,qBAAKpC,YAAL,GAAoB,KAApB;AACH,aAfD,MAgBI;AACAqC;AACA,oBAAGA,WAAW,EAAd,EAAiB;AACbG,4BAAQC,GAAR,CAAY,aAAZ;AACA;AACH;AACDC,2BAAWJ,EAAX,EAAc,EAAd;AACH;AACJ,SAzBD;AA0BAI,mBAAWJ,EAAX,EAAc,EAAd;AACH,KAzGI;;AA2GLK,iBAAY,qBAASC,IAAT,EAAc;AACtB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACH;AApHI,CAAT","file":"AnysdkMgr.js","sourceRoot":"..\\..\\..\\..\\assets\\scripts","sourcesContent":["cc.Class({\r\n    extends: cc.Component,\r\n\r\n    properties: {\r\n        // foo: {\r\n        //    default: null,      // The default value will be used only when the component attaching\r\n        //                           to a node for the first time\r\n        //    url: cc.Texture2D,  // optional, default is typeof default\r\n        //    serializable: true, // optional, default is true\r\n        //    visible: true,      // optional, default is true\r\n        //    displayName: 'Foo', // optional\r\n        //    readonly: false,    // optional, default is false\r\n        // },\r\n        // ...\r\n        _isCapturing:false,\r\n    },\r\n\r\n    // use this for initialization\r\n    onLoad: function () {\r\n    },\r\n\r\n    // called every frame, uncomment this function to activate update callback\r\n    // update: function (dt) {\r\n\r\n    // },\r\n    \r\n    init:function(){\r\n        this.ANDROID_API = \"com/vivigames/scmj/WXAPI\";\r\n        this.IOS_API = \"AppController\";\r\n    },\r\n    \r\n    login:function(){\r\n\r\n        //注释掉所有的调原声的\r\n        // if(cc.sys.os == cc.sys.OS_ANDROID){ \r\n        //     jsb.reflection.callStaticMethod(this.ANDROID_API, \"Login\", \"()V\");\r\n        // }\r\n        // else if(cc.sys.os == cc.sys.OS_IOS){\r\n        //     jsb.reflection.callStaticMethod(this.IOS_API, \"login\");\r\n        // }\r\n        // else{\r\n        //     console.log(\"platform:\" + cc.sys.os + \" dosn't implement share.\");\r\n        // }\r\n    },\r\n    \r\n    share:function(title,desc){\r\n        // if(cc.sys.os == cc.sys.OS_ANDROID){\r\n        //     jsb.reflection.callStaticMethod(this.ANDROID_API, \"Share\", \"(Ljava/lang/String;Ljava/lang/String;Ljava/lang/String;)V\",cc.vv.SI.appweb,title,desc);\r\n        // }\r\n        // else if(cc.sys.os == cc.sys.OS_IOS){\r\n        //     jsb.reflection.callStaticMethod(this.IOS_API, \"share:shareTitle:shareDesc:\",cc.vv.SI.appweb,title,desc);\r\n        // }\r\n        // else{\r\n        //     console.log(\"platform:\" + cc.sys.os + \" dosn't implement share.\");\r\n        // }\r\n    },\r\n    \r\n    shareResult:function(){\r\n        if(this._isCapturing){\r\n            return;\r\n        }\r\n        this._isCapturing = true;\r\n        var size = cc.director.getWinSize();\r\n        var currentDate = new Date();\r\n        var fileName = \"result_share.jpg\";\r\n        var fullPath = jsb.fileUtils.getWritablePath() + fileName;\r\n        if(jsb.fileUtils.isFileExist(fullPath)){\r\n            jsb.fileUtils.removeFile(fullPath);\r\n        }\r\n        var texture = new cc.RenderTexture(Math.floor(size.width), Math.floor(size.height));\r\n        texture.setPosition(cc.p(size.width/2, size.height/2));\r\n        texture.begin();\r\n        cc.director.getRunningScene().visit();\r\n        texture.end();\r\n        texture.saveToFile(fileName, cc.IMAGE_FORMAT_JPG);\r\n        \r\n        var self = this;\r\n        var tryTimes = 0;\r\n        var fn = function(){\r\n            if(jsb.fileUtils.isFileExist(fullPath)){\r\n                var height = 100;\r\n                var scale = height/size.height;\r\n\t\t\t    var width = Math.floor(size.width * scale);\r\n                \r\n                // if(cc.sys.os == cc.sys.OS_ANDROID){\r\n                //     jsb.reflection.callStaticMethod(self.ANDROID_API, \"ShareIMG\", \"(Ljava/lang/String;II)V\",fullPath,width,height);\r\n                // }\r\n                // else if(cc.sys.os == cc.sys.OS_IOS){\r\n                //     jsb.reflection.callStaticMethod(self.IOS_API, \"shareIMG:width:height:\",fullPath,width,height);\r\n                // }\r\n                // else{\r\n                //     console.log(\"platform:\" + cc.sys.os + \" dosn't implement share.\");\r\n                // }\r\n                self._isCapturing = false;\r\n            }\r\n            else{\r\n                tryTimes++;\r\n                if(tryTimes > 10){\r\n                    console.log(\"time out...\");\r\n                    return;\r\n                }\r\n                setTimeout(fn,50); \r\n            }\r\n        }\r\n        setTimeout(fn,50);\r\n    },\r\n    \r\n    onLoginResp:function(code){\r\n        // var fn = function(ret){\r\n        //     if(ret.errcode == 0){\r\n        //         cc.sys.localStorage.setItem(\"wx_account\",ret.account);\r\n        //         cc.sys.localStorage.setItem(\"wx_sign\",ret.sign);\r\n        //     }\r\n        //     cc.vv.userMgr.onAuth(ret);\r\n        // }\r\n        // cc.vv.http.sendRequest(\"/wechat_auth\",{code:code,os:cc.sys.os},fn);\r\n    },\r\n});\r\n"]}