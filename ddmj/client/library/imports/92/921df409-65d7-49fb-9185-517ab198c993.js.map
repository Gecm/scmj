{"version":3,"sources":["..\\..\\..\\..\\..\\assets\\scripts\\components/assets\\scripts\\components\\MJRoom.js"],"names":["cc","Class","extends","Component","properties","lblRoomNo","default","type","Label","_seats","_seats2","_timeLabel","_voiceMsgQueue","_lastPlayingSeat","_playingSeat","_lastPlayTime","onLoad","vv","initView","initSeats","initEventHandlers","prepare","node","getChildByName","seats","i","children","length","push","getComponent","refreshBtns","find","string","gameNetMgr","roomId","gameChild","sides","sideNode","seat","btnWechat","utils","addClickEvent","titles","active","conf","btnExit","btnDispress","btnWeichat","btnBack","isIdle","numOfGames","isOwner","self","on","data","initSingleSeat","detail","refreshXuanPaiState","idx","seatindex","localIdx","getLocalIndex","playVoice","getSeatIndexByID","sender","chat","content","index","info","getQuickChatInfo","audioMgr","playSFX","sound","console","log","emoji","isOffline","online","isZhuang","button","setInfo","name","score","setReady","ready","setOffline","setID","userid","voiceMsg","setZhuang","onBtnSettingsClicked","popupMgr","showSettings","onBtnBackClicked","alert","show","director","loadScene","onBtnChatClicked","onBtnWeichatClicked","title","anysdkMgr","share","getWanfa","onBtnDissolveClicked","net","send","onBtnExit","shift","localIndex","msgInfo","JSON","parse","msgfile","msg","voiceMgr","writeVoice","play","Date","now","time","update","dt","minutes","Math","floor","_lastMinute","date","h","getHours","m","getMinutes","onPlayerOver","resumeAll","onDestroy","stop"],"mappings":"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","file":"MJRoom.js","sourceRoot":"..\\..\\..\\..\\..\\assets\\scripts\\components","sourcesContent":["cc.Class({\r\n    extends: cc.Component,\r\n\r\n    properties: {\r\n        lblRoomNo:{\r\n            default:null,\r\n            type:cc.Label\r\n        },\r\n        // foo: {\r\n        //    default: null,\r\n        //    url: cc.Texture2D,  // optional, default is typeof default\r\n        //    serializable: true, // optional, default is true\r\n        //    visible: true,      // optional, default is true\r\n        //    displayName: 'Foo', // optional\r\n        //    readonly: false,    // optional, default is false\r\n        // },\r\n        // ...\r\n        _seats:[],\r\n        _seats2:[],\r\n        _timeLabel:null,\r\n        _voiceMsgQueue:[],\r\n        _lastPlayingSeat:null,\r\n        _playingSeat:null,\r\n        _lastPlayTime:null,\r\n    },\r\n\r\n    // use this for initialization\r\n    onLoad: function () {\r\n        if(cc.vv == null){\r\n            return;\r\n        }\r\n        \r\n        this.initView();\r\n        this.initSeats();\r\n        this.initEventHandlers();\r\n    },\r\n    //初始化视图\r\n    initView:function(){\r\n        var prepare = this.node.getChildByName(\"prepare\");\r\n        var seats = prepare.getChildByName(\"seats\");\r\n        for(var i = 0; i < seats.children.length; ++i){\r\n            this._seats.push(seats.children[i].getComponent(\"Seat\"));\r\n        }\r\n        \r\n        this.refreshBtns();\r\n        \r\n        this.lblRoomNo = cc.find(\"Canvas/infobar/Z_room_txt/New Label\").getComponent(cc.Label);\r\n        this._timeLabel = cc.find(\"Canvas/infobar/time\").getComponent(cc.Label);\r\n        this.lblRoomNo.string = cc.vv.gameNetMgr.roomId;\r\n        var gameChild = this.node.getChildByName(\"game\");\r\n        var sides = [\"myself\",\"right\",\"up\",\"left\"];\r\n        for(var i = 0; i < sides.length; ++i){\r\n            var sideNode = gameChild.getChildByName(sides[i]);\r\n            var seat = sideNode.getChildByName(\"seat\");\r\n            this._seats2.push(seat.getComponent(\"Seat\"));\r\n        }\r\n        \r\n        var btnWechat = cc.find(\"Canvas/prepare/btnWeichat\");\r\n        if(btnWechat){\r\n            cc.vv.utils.addClickEvent(btnWechat,this.node,\"MJRoom\",\"onBtnWeichatClicked\");\r\n        }\r\n        \r\n        \r\n        var titles = cc.find(\"Canvas/typeTitle\");\r\n        for(var i = 0; i < titles.children.length; ++i){\r\n            titles.children[i].active = false;\r\n        }\r\n        \r\n        if(cc.vv.gameNetMgr.conf){\r\n            var type = cc.vv.gameNetMgr.conf.type;\r\n            if(type == null || type == \"\"){\r\n                type = \"xzdd\";\r\n            }\r\n            //console.log(cc.vv.gameNetMgr.conf.type);\r\n            titles.getChildByName(type).active = true;   \r\n        }\r\n    },\r\n    \r\n    refreshBtns:function(){\r\n        var prepare = this.node.getChildByName(\"prepare\");\r\n        var btnExit = prepare.getChildByName(\"btnExit\");\r\n        var btnDispress = prepare.getChildByName(\"btnDissolve\");\r\n        var btnWeichat = prepare.getChildByName(\"btnWeichat\");\r\n        var btnBack = prepare.getChildByName(\"btnBack\");\r\n        var isIdle = cc.vv.gameNetMgr.numOfGames == 0;\r\n        \r\n        btnExit.active = !cc.vv.gameNetMgr.isOwner() && isIdle;\r\n        btnDispress.active = cc.vv.gameNetMgr.isOwner() && isIdle;\r\n        \r\n        btnWeichat.active = isIdle;\r\n        btnBack.active = isIdle;\r\n    },\r\n    \r\n    initEventHandlers:function(){\r\n        var self = this;\r\n        //on一般是接受消息\r\n        this.node.on('new_user',function(data){\r\n            self.initSingleSeat(data.detail);\r\n        });\r\n        \r\n        this.node.on('user_state_changed',function(data){\r\n            self.initSingleSeat(data.detail);\r\n        });\r\n        \r\n        this.node.on('game_begin',function(data){\r\n            self.refreshBtns();\r\n            self.initSeats();\r\n        });\r\n        \r\n        this.node.on('game_num',function(data){\r\n            self.refreshBtns();\r\n        });\r\n\r\n        this.node.on('game_huanpai',function(data){\r\n            for(var i in self._seats2){\r\n                self._seats2[i].refreshXuanPaiState();    \r\n            }\r\n        });\r\n                \r\n        this.node.on('huanpai_notify',function(data){\r\n            var idx = data.detail.seatindex;\r\n            var localIdx = cc.vv.gameNetMgr.getLocalIndex(idx);\r\n            self._seats2[localIdx].refreshXuanPaiState();\r\n        });\r\n        \r\n        this.node.on('game_huanpai_over',function(data){\r\n            for(var i in self._seats2){\r\n                self._seats2[i].refreshXuanPaiState();    \r\n            }\r\n        });\r\n        \r\n        this.node.on('voice_msg',function(data){\r\n            var data = data.detail;\r\n            self._voiceMsgQueue.push(data);\r\n            self.playVoice();\r\n        });\r\n        \r\n        this.node.on('chat_push',function(data){\r\n            var data = data.detail;\r\n            var idx = cc.vv.gameNetMgr.getSeatIndexByID(data.sender);\r\n            var localIdx = cc.vv.gameNetMgr.getLocalIndex(idx);\r\n            self._seats[localIdx].chat(data.content);\r\n            self._seats2[localIdx].chat(data.content);\r\n        });\r\n        \r\n        this.node.on('quick_chat_push',function(data){\r\n            var data = data.detail;\r\n            var idx = cc.vv.gameNetMgr.getSeatIndexByID(data.sender);\r\n            var localIdx = cc.vv.gameNetMgr.getLocalIndex(idx);\r\n            \r\n            var index = data.content;\r\n            var info = cc.vv.chat.getQuickChatInfo(index);\r\n            self._seats[localIdx].chat(info.content);\r\n            self._seats2[localIdx].chat(info.content);\r\n            \r\n            cc.vv.audioMgr.playSFX(info.sound);\r\n        });\r\n        \r\n        this.node.on('emoji_push',function(data){\r\n            var data = data.detail;\r\n            var idx = cc.vv.gameNetMgr.getSeatIndexByID(data.sender);\r\n            var localIdx = cc.vv.gameNetMgr.getLocalIndex(idx);\r\n            console.log(data);\r\n            self._seats[localIdx].emoji(data.content);\r\n            self._seats2[localIdx].emoji(data.content);\r\n        });\r\n    },\r\n    \r\n    initSeats:function(){\r\n        var seats = cc.vv.gameNetMgr.seats;\r\n        for(var i = 0; i < seats.length; ++i){\r\n            this.initSingleSeat(seats[i]);\r\n        }\r\n    },\r\n    \r\n    initSingleSeat:function(seat){\r\n        var index = cc.vv.gameNetMgr.getLocalIndex(seat.seatindex);\r\n        var isOffline = !seat.online;\r\n        var isZhuang = seat.seatindex == cc.vv.gameNetMgr.button;\r\n        \r\n        console.log(\"isOffline:\" + isOffline);\r\n        \r\n        this._seats[index].setInfo(seat.name,seat.score);\r\n        this._seats[index].setReady(seat.ready);\r\n        this._seats[index].setOffline(isOffline);\r\n        this._seats[index].setID(seat.userid);\r\n        this._seats[index].voiceMsg(false);\r\n        \r\n        this._seats2[index].setInfo(seat.name,seat.score);\r\n        this._seats2[index].setZhuang(isZhuang);\r\n        this._seats2[index].setOffline(isOffline);\r\n        this._seats2[index].setID(seat.userid);\r\n        this._seats2[index].voiceMsg(false);\r\n        this._seats2[index].refreshXuanPaiState();\r\n    },\r\n    \r\n    onBtnSettingsClicked:function(){\r\n        cc.vv.popupMgr.showSettings();   \r\n    },\r\n\r\n    onBtnBackClicked:function(){\r\n        cc.vv.alert.show(\"返回大厅\",\"返回大厅房间仍会保留，快去邀请大伙来玩吧！\",function(){\r\n            cc.director.loadScene(\"hall\");    \r\n        },true);\r\n    },\r\n    \r\n    onBtnChatClicked:function(){\r\n        \r\n    },\r\n    \r\n    onBtnWeichatClicked:function(){\r\n        var title = \"<血战到底>\";\r\n        if(cc.vv.gameNetMgr.conf.type == \"xlch\"){\r\n            var title = \"<血流成河>\";\r\n        }\r\n        cc.vv.anysdkMgr.share(\"达达麻将\" + title,\"房号:\" + cc.vv.gameNetMgr.roomId + \" 玩法:\" + cc.vv.gameNetMgr.getWanfa());\r\n    },\r\n    \r\n    onBtnDissolveClicked:function(){\r\n        cc.vv.alert.show(\"解散房间\",\"解散房间不扣房卡，是否确定解散？\",function(){\r\n            cc.vv.net.send(\"dispress\");    \r\n        },true);\r\n    },\r\n    \r\n    onBtnExit:function(){\r\n        cc.vv.net.send(\"exit\");\r\n    },\r\n    \r\n    playVoice:function(){\r\n        if(this._playingSeat == null && this._voiceMsgQueue.length){\r\n            console.log(\"playVoice2\");\r\n            var data = this._voiceMsgQueue.shift();\r\n            var idx = cc.vv.gameNetMgr.getSeatIndexByID(data.sender);\r\n            var localIndex = cc.vv.gameNetMgr.getLocalIndex(idx);\r\n            this._playingSeat = localIndex;\r\n            this._seats[localIndex].voiceMsg(true);\r\n            this._seats2[localIndex].voiceMsg(true);\r\n            \r\n            var msgInfo = JSON.parse(data.content);\r\n            \r\n            var msgfile = \"voicemsg.amr\";\r\n            console.log(msgInfo.msg.length);\r\n            cc.vv.voiceMgr.writeVoice(msgfile,msgInfo.msg);\r\n            cc.vv.voiceMgr.play(msgfile);\r\n            this._lastPlayTime = Date.now() + msgInfo.time;\r\n        }\r\n    },\r\n    \r\n    // called every frame, uncomment this function to activate update callback\r\n    update: function (dt) {\r\n        var minutes = Math.floor(Date.now()/1000/60);\r\n        if(this._lastMinute != minutes){\r\n            this._lastMinute = minutes;\r\n            var date = new Date();\r\n            var h = date.getHours();\r\n            h = h < 10? \"0\"+h:h;\r\n            \r\n            var m = date.getMinutes();\r\n            m = m < 10? \"0\"+m:m;\r\n            this._timeLabel.string = \"\" + h + \":\" + m;             \r\n        }\r\n        \r\n        \r\n        if(this._lastPlayTime != null){\r\n            if(Date.now() > this._lastPlayTime + 200){\r\n                this.onPlayerOver();\r\n                this._lastPlayTime = null;    \r\n            }\r\n        }\r\n        else{\r\n            this.playVoice();\r\n        }\r\n    },\r\n    \r\n        \r\n    onPlayerOver:function(){\r\n        cc.vv.audioMgr.resumeAll();\r\n        console.log(\"onPlayCallback:\" + this._playingSeat);\r\n        var localIndex = this._playingSeat;\r\n        this._playingSeat = null;\r\n        this._seats[localIndex].voiceMsg(false);\r\n        this._seats2[localIndex].voiceMsg(false);\r\n    },\r\n    \r\n    onDestroy:function(){\r\n        cc.vv.voiceMgr.stop();\r\n//        cc.vv.voiceMgr.onPlayCallback = null;\r\n    }\r\n});\r\n"]}