{"version":3,"sources":["..\\..\\..\\..\\assets\\scripts/assets\\scripts\\ReplayMgr.js"],"names":["ACTION_CHUPAI","ACTION_MOPAI","ACTION_PENG","ACTION_GANG","ACTION_HU","cc","Class","extends","Component","properties","_lastAction","_actionRecords","_currentIndex","onLoad","clear","init","data","action_records","isReplay","getNextAction","length","si","action","pai","type","takeAction","vv","gameNetMgr","doGuo","nextActionDelay","doChupai","doMopai","doTurnChange","doPeng","dispatchEvent","doGang","doHu","seatindex","hupai","iszimo"],"mappings":"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","file":"ReplayMgr.js","sourceRoot":"..\\..\\..\\..\\assets\\scripts","sourcesContent":["var ACTION_CHUPAI = 1;\r\nvar ACTION_MOPAI = 2;\r\nvar ACTION_PENG = 3;\r\nvar ACTION_GANG = 4;\r\nvar ACTION_HU = 5;\r\n\r\n\r\ncc.Class({\r\n    extends: cc.Component,\r\n\r\n    properties: {\r\n        // foo: {\r\n        //    default: null,\r\n        //    url: cc.Texture2D,  // optional, default is typeof default\r\n        //    serializable: true, // optional, default is true\r\n        //    visible: true,      // optional, default is true\r\n        //    displayName: 'Foo', // optional\r\n        //    readonly: false,    // optional, default is false\r\n        // },\r\n        // ...\r\n        _lastAction:null,\r\n        _actionRecords:null,\r\n        _currentIndex:0,\r\n    },\r\n\r\n    // use this for initialization\r\n    onLoad: function () {\r\n\r\n    },\r\n    \r\n    clear:function(){\r\n        this._lastAction = null;\r\n        this._actionRecords = null;\r\n        this._currentIndex = 0;\r\n    },\r\n    \r\n    init:function(data){\r\n        this._actionRecords = data.action_records;\r\n        if(this._actionRecords == null){\r\n            this._actionRecords = {};\r\n        }\r\n        this._currentIndex = 0;\r\n        this._lastAction = null;\r\n    },\r\n    \r\n    isReplay:function(){\r\n        return this._actionRecords != null;    \r\n    },\r\n    \r\n    getNextAction:function(){\r\n        if(this._currentIndex >= this._actionRecords.length){\r\n            return null;\r\n        }\r\n        \r\n        var si = this._actionRecords[this._currentIndex++];\r\n        var action = this._actionRecords[this._currentIndex++];\r\n        var pai = this._actionRecords[this._currentIndex++];\r\n        return {si:si,type:action,pai:pai};\r\n    },\r\n    \r\n    takeAction:function(){\r\n        var action = this.getNextAction();\r\n        if(this._lastAction != null && this._lastAction.type == ACTION_CHUPAI){\r\n            if(action != null && action.type != ACTION_PENG && action.type != ACTION_GANG && action.type != ACTION_HU){\r\n                cc.vv.gameNetMgr.doGuo(this._lastAction.si,this._lastAction.pai);\r\n            }\r\n        }\r\n        this._lastAction = action;\r\n        if(action == null){\r\n            return -1;\r\n        }\r\n        var nextActionDelay = 1.0;\r\n        if(action.type == ACTION_CHUPAI){\r\n            //console.log(\"chupai\");\r\n            cc.vv.gameNetMgr.doChupai(action.si,action.pai);\r\n            return 1.0;\r\n        }\r\n        else if(action.type == ACTION_MOPAI){\r\n            //console.log(\"mopai\");\r\n            cc.vv.gameNetMgr.doMopai(action.si,action.pai);\r\n            cc.vv.gameNetMgr.doTurnChange(action.si);\r\n            return 0.5;\r\n        }\r\n        else if(action.type == ACTION_PENG){\r\n            //console.log(\"peng\");\r\n            cc.vv.gameNetMgr.doPeng(action.si,action.pai);\r\n            cc.vv.gameNetMgr.doTurnChange(action.si);\r\n            return 1.0;\r\n        }\r\n        else if(action.type == ACTION_GANG){\r\n            //console.log(\"gang\");\r\n            cc.vv.gameNetMgr.dispatchEvent('hangang_notify',action.si);\r\n            cc.vv.gameNetMgr.doGang(action.si,action.pai);\r\n            cc.vv.gameNetMgr.doTurnChange(action.si);\r\n            return 1.0;\r\n        }\r\n        else if(action.type == ACTION_HU){\r\n            //console.log(\"hu\");\r\n            cc.vv.gameNetMgr.doHu({seatindex:action.si,hupai:action.pai,iszimo:false});\r\n            return 1.5;\r\n        }\r\n    }\r\n\r\n    // called every frame, uncomment this function to activate update callback\r\n    // update: function (dt) {\r\n\r\n    // },\r\n});\r\n"]}