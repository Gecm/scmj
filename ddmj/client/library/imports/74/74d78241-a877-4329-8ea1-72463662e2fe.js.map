{"version":3,"sources":["..\\..\\..\\..\\assets\\scripts/assets\\scripts\\UserMgr.js"],"names":["cc","Class","extends","Component","properties","account","userId","userName","lv","exp","coins","gems","sign","ip","sex","roomData","oldRoomId","guestAuth","args","sys","localStorage","getItem","Date","now","setItem","vv","http","sendRequest","onAuth","ret","self","userMgr","errcode","console","log","errmsg","url","SI","hall","login","onLogin","userid","director","loadScene","name","roomid","wc","show","create","onCreate","data","enterRoom","roomId","callback","onEnter","setTimeout","hide","gameNetMgr","connectGameServer","getHistoryList","onGet","history","getGamesOfRoom","uuid","getDetailOfGame","index"],"mappings":"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","file":"UserMgr.js","sourceRoot":"..\\..\\..\\..\\assets\\scripts","sourcesContent":["cc.Class({\r\n    extends: cc.Component,\r\n    properties: {\r\n        account:null,\r\n\t    userId:null,\r\n\t\tuserName:null,\r\n\t\tlv:0,\r\n\t\texp:0,\r\n\t\tcoins:0,\r\n\t\tgems:0,\r\n\t\tsign:0,\r\n        ip:\"\",\r\n        sex:0,\r\n        roomData:null,\r\n        \r\n        oldRoomId:null,\r\n    },\r\n    \r\n    guestAuth:function(){\r\n        var account = cc.args[\"account\"];\r\n        if(account == null){\r\n            account = cc.sys.localStorage.getItem(\"account\");\r\n        }\r\n        \r\n        if(account == null){\r\n            account = Date.now();\r\n            cc.sys.localStorage.setItem(\"account\",account);\r\n        }\r\n        \r\n        cc.vv.http.sendRequest(\"/guest\",{account:account},this.onAuth);\r\n    },\r\n    \r\n    onAuth:function(ret){\r\n        var self = cc.vv.userMgr;\r\n        if(ret.errcode !== 0){\r\n            console.log(ret.errmsg);\r\n        }\r\n        else{\r\n            self.account = ret.account;\r\n            self.sign = ret.sign;\r\n            //这里cc.vv.SI.hall = 169.254.245.17:9001;\r\n            cc.vv.http.url = \"http://\" + cc.vv.SI.hall;\r\n       \r\n            self.login();\r\n        }   \r\n    },\r\n    \r\n    login:function(){\r\n        var self = this;\r\n        var onLogin = function(ret){\r\n            if(ret.errcode !== 0){\r\n                console.log(ret.errmsg);\r\n            }\r\n            else{\r\n                if(!ret.userid){\r\n                    //jump to register user info.\r\n                    cc.director.loadScene(\"createrole\");\r\n                }\r\n                else{\r\n                    console.log(ret);\r\n                    self.account = ret.account;\r\n        \t\t\tself.userId = ret.userid;\r\n        \t\t\tself.userName = ret.name;\r\n        \t\t\tself.lv = ret.lv;\r\n        \t\t\tself.exp = ret.exp;\r\n        \t\t\tself.coins = ret.coins;\r\n        \t\t\tself.gems = ret.gems;\r\n                    self.roomData = ret.roomid;\r\n                    self.sex = ret.sex;\r\n                    self.ip = ret.ip;\r\n        \t\t\tcc.director.loadScene(\"hall\");\r\n                }\r\n            }\r\n        };\r\n        cc.vv.wc.show(\"正在登录游戏\");\r\n       //这里就是给大厅服务器发消息了\r\n        cc.vv.http.sendRequest(\"/login\",{account:this.account,sign:this.sign},onLogin);\r\n    },\r\n    \r\n    create:function(name){\r\n        var self = this;\r\n        var onCreate = function(ret){\r\n            if(ret.errcode !== 0){\r\n                console.log(ret.errmsg);\r\n            }\r\n            else{\r\n                self.login();\r\n            }\r\n        };\r\n        \r\n        var data = {\r\n            account:this.account,\r\n            sign:this.sign,\r\n            name:name\r\n        };\r\n        cc.vv.http.sendRequest(\"/create_user\",data,onCreate);    \r\n    },\r\n    \r\n    enterRoom:function(roomId,callback){\r\n        var self = this;\r\n        var onEnter = function(ret){\r\n            if(ret.errcode !== 0){\r\n                if(ret.errcode == -1){\r\n                    setTimeout(function(){\r\n                        self.enterRoom(roomId,callback);\r\n                    },5000);\r\n                }\r\n                else{\r\n                    cc.vv.wc.hide();\r\n                    if(callback != null){\r\n                        callback(ret);\r\n                    }\r\n                }\r\n            }\r\n            else{\r\n                if(callback != null){\r\n                    callback(ret);\r\n                }\r\n                cc.vv.gameNetMgr.connectGameServer(ret);\r\n            }\r\n        };\r\n        \r\n        var data = {\r\n            account:cc.vv.userMgr.account,\r\n            sign:cc.vv.userMgr.sign,\r\n            roomid:roomId\r\n        };\r\n        cc.vv.wc.show(\"正在进入房间 \" + roomId);\r\n        cc.vv.http.sendRequest(\"/enter_private_room\",data,onEnter);\r\n    },\r\n    getHistoryList:function(callback){\r\n        var self = this;\r\n        var onGet = function(ret){\r\n            if(ret.errcode !== 0){\r\n                console.log(ret.errmsg);\r\n            }\r\n            else{\r\n                console.log(ret.history);\r\n                if(callback != null){\r\n                    callback(ret.history);\r\n                }\r\n            }\r\n        };\r\n        \r\n        var data = {\r\n            account:cc.vv.userMgr.account,\r\n            sign:cc.vv.userMgr.sign,\r\n        };\r\n        cc.vv.http.sendRequest(\"/get_history_list\",data,onGet);\r\n    },\r\n    getGamesOfRoom:function(uuid,callback){\r\n        var self = this;\r\n        var onGet = function(ret){\r\n            if(ret.errcode !== 0){\r\n                console.log(ret.errmsg);\r\n            }\r\n            else{\r\n                console.log(ret.data);\r\n                callback(ret.data);\r\n            }\r\n        };\r\n        \r\n        var data = {\r\n            account:cc.vv.userMgr.account,\r\n            sign:cc.vv.userMgr.sign,\r\n            uuid:uuid,\r\n        };\r\n        cc.vv.http.sendRequest(\"/get_games_of_room\",data,onGet);\r\n    },\r\n    \r\n    getDetailOfGame:function(uuid,index,callback){\r\n        var self = this;\r\n        var onGet = function(ret){\r\n            if(ret.errcode !== 0){\r\n                console.log(ret.errmsg);\r\n            }\r\n            else{\r\n                console.log(ret.data);\r\n                callback(ret.data);\r\n            }       \r\n        };\r\n        \r\n        var data = {\r\n            account:cc.vv.userMgr.account,\r\n            sign:cc.vv.userMgr.sign,\r\n            uuid:uuid,\r\n            index:index,\r\n        };\r\n        cc.vv.http.sendRequest(\"/get_detail_of_game\",data,onGet);\r\n    }\r\n});\r\n"]}