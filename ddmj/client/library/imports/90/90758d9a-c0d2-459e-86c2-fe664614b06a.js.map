{"version":3,"sources":["..\\..\\..\\..\\..\\assets\\scripts\\components/assets\\scripts\\components\\DingQue.js"],"names":["cc","Class","extends","Component","properties","queYiMen","tips","selected","dingques","onLoad","vv","initView","initDingQue","initEventHandlers","gameChild","node","getChildByName","active","gameNetMgr","isDingQueing","arr","i","length","side","seat","dingque","push","reset","childrenCount","n","children","getComponent","Label","gamestate","showDingQueChoice","self","on","data","seatIndex","getSeatIndexByID","detail","localIndex","getLocalIndex","console","log","sd","getSelfData","typeCounts","holds","pai","type","mahjongmgr","getMahjongType","min","minIndex","Animation","play","stop","seats","que","setInteractable","j","onQueYiMenClicked","event","target","name","net","send","value","Button","interactable"],"mappings":"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","file":"DingQue.js","sourceRoot":"..\\..\\..\\..\\..\\assets\\scripts\\components","sourcesContent":["cc.Class({\r\n    extends: cc.Component,\r\n\r\n    properties: {\r\n        queYiMen:null,\r\n        tips:[],\r\n        selected:[],\r\n        dingques:[],\r\n        // foo: {\r\n        //    default: null,\r\n        //    url: cc.Texture2D,  // optional, default is typeof default\r\n        //    serializable: true, // optional, default is true\r\n        //    visible: true,      // optional, default is true\r\n        //    displayName: 'Foo', // optional\r\n        //    readonly: false,    // optional, default is false\r\n        // },\r\n        // ...\r\n    },\r\n\r\n    // use this for initialization\r\n    onLoad: function () {\r\n        if(cc.vv == null){\r\n            return;\r\n        }\r\n        this.initView();\r\n      //  console.log('你好'+cc.vv.gameNetMgr.conf.type);\r\n        this.initDingQue();\r\n        this.initEventHandlers();\r\n    },\r\n    \r\n    initView:function(){\r\n        var gameChild = this.node.getChildByName(\"game\");\r\n        this.queYiMen = gameChild.getChildByName(\"dingque\");\r\n\r\n        \r\n        \r\n        this.queYiMen.active = cc.vv.gameNetMgr.isDingQueing;\r\n     \r\n        \r\n\r\n        var arr = [\"myself\",\"right\",\"up\",\"left\"];\r\n        for(var i = 0; i < arr.length; ++i){\r\n            var side = gameChild.getChildByName(arr[i]);\r\n            var seat = side.getChildByName(\"seat\");\r\n            var dingque = seat.getChildByName(\"que\");\r\n            this.dingques.push(dingque);\r\n        }\r\n        this.reset();\r\n        \r\n        var tips = this.queYiMen.getChildByName(\"tips\");\r\n        for(var i = 0; i < tips.childrenCount; ++i){\r\n            var n = tips.children[i];\r\n            this.tips.push(n.getComponent(cc.Label));\r\n        }\r\n        \r\n        if(cc.vv.gameNetMgr.gamestate == \"dingque\"){\r\n            this.showDingQueChoice();\r\n        }\r\n    },\r\n    \r\n    initEventHandlers:function(){\r\n        var self = this;\r\n        this.node.on('game_dingque',function(data){\r\n            self.showDingQueChoice();\r\n        });\r\n        \r\n        this.node.on('game_dingque_notify',function(data){\r\n            var seatIndex = cc.vv.gameNetMgr.getSeatIndexByID(data.detail);\r\n            var localIndex = cc.vv.gameNetMgr.getLocalIndex(seatIndex);\r\n            console.log(\"game_dingque_notify:\" + localIndex);\r\n            self.tips[localIndex].node.active = true;\r\n        });\r\n        \r\n        this.node.on('game_dingque_finish',function(){\r\n            //通知每一个玩家定缺的花色\r\n            self.queYiMen.active = false;\r\n            cc.vv.gameNetMgr.isDingQueing = false;\r\n            self.initDingQue();\r\n        });\r\n    },\r\n    \r\n    showDingQueChoice:function(){\r\n        this.queYiMen.active = true;\r\n        var sd = cc.vv.gameNetMgr.getSelfData();\r\n        var typeCounts = [0,0,0];\r\n        for(var i = 0; i < sd.holds.length; ++i){\r\n            var pai = sd.holds[i];\r\n            var type = cc.vv.mahjongmgr.getMahjongType(pai);\r\n            typeCounts[type]++;\r\n        }\r\n        \r\n        var min = 65535;\r\n        var minIndex = 0;\r\n        for(var i = 0; i < typeCounts.length; ++i){\r\n            if(typeCounts[i] < min){\r\n                min = typeCounts[i];\r\n                minIndex = i;\r\n            }\r\n        }\r\n        \r\n        var arr = [\"tong\",\"tiao\",\"wan\"];\r\n        for(var i = 0; i < arr.length; ++i){\r\n            var node = this.queYiMen.getChildByName(arr[i]);\r\n            if(minIndex == i){\r\n                node.getComponent(cc.Animation).play(\"dingque_tuijian\");\r\n            }\r\n            else{\r\n                node.getComponent(cc.Animation).stop();\r\n            }\r\n            //this.queYiMen.getChildByName(arr[i]).getChildByName('jian').active = minIndex == i;    \r\n        }\r\n        \r\n        this.reset();\r\n        for(var i = 0; i < this.tips.length; ++i){\r\n            var n = this.tips[i];\r\n            if(i > 0){\r\n                n.node.active = false;                \r\n            }\r\n            else{\r\n                n.node.active = true;\r\n            }\r\n        }\r\n    },\r\n    \r\n    initDingQue:function(){\r\n        var arr = [\"tong\",\"tiao\",\"wan\"];\r\n        var data = cc.vv.gameNetMgr.seats;\r\n        for(var i = 0; i < data.length; ++i){\r\n            var que = data[i].dingque;\r\n            if(que == null || que < 0 || que >= arr.length){\r\n                que = null;\r\n            }\r\n            else{\r\n                que = arr[que]; \r\n            }\r\n            \r\n            var localIndex = cc.vv.gameNetMgr.getLocalIndex(i);\r\n            if(que){\r\n                this.dingques[localIndex].getChildByName(que).active = true;    \r\n            }\r\n        }\r\n    },\r\n    \r\n    reset:function(){\r\n        this.setInteractable(true);\r\n        \r\n        this.selected.push(this.queYiMen.getChildByName(\"tong_selected\"));\r\n        this.selected.push(this.queYiMen.getChildByName(\"tiao_selected\"));\r\n        this.selected.push(this.queYiMen.getChildByName(\"wan_selected\"));\r\n        for(var i = 0; i < this.selected.length; ++i){\r\n            this.selected[i].active = false;\r\n        }        \r\n        \r\n        for(var i = 0; i < this.dingques.length; ++i){\r\n            for(var j = 0; j < this.dingques[i].children.length; ++j){\r\n                this.dingques[i].children[j].active = false;    \r\n            }\r\n        }\r\n    },\r\n    \r\n    onQueYiMenClicked:function(event){\r\n        var type = 0;\r\n        if(event.target.name == \"tong\"){\r\n            type = 0;\r\n        }\r\n        else if(event.target.name == \"tiao\"){\r\n            type = 1;\r\n        }\r\n        else if(event.target.name == \"wan\"){\r\n            type = 2;\r\n        }\r\n        \r\n        for(var i = 0; i < this.selected.length; ++i){\r\n            this.selected[i].active = false;\r\n        }  \r\n        this.selected[type].active = true;\r\n        cc.vv.gameNetMgr.dingque = type;\r\n        //向socket服务器发送 定缺消息说我自己缺哪一门\r\n        cc.vv.net.send(\"dingque\",type);\r\n        \r\n        //this.setInteractable(false);\r\n    },\r\n    \r\n    setInteractable:function(value){\r\n        this.queYiMen.getChildByName(\"tong\").getComponent(cc.Button).interactable = value;\r\n        this.queYiMen.getChildByName(\"tiao\").getComponent(cc.Button).interactable = value;\r\n        this.queYiMen.getChildByName(\"wan\").getComponent(cc.Button).interactable = value;        \r\n    }\r\n\r\n    // called every frame, uncomment this function to activate update callback\r\n    // update: function (dt) {\r\n\r\n    // },\r\n});\r\n"]}